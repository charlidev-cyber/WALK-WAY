<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - WalkWay</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="checkout.css">
    <style>
        body {
            background: #f8f9fa;
        }
        
        .checkout-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .checkout-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .checkout-header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .checkout-header p {
            color: #666;
            font-size: 16px;
        }
        
        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #f39c12;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 30px;
            transition: color 0.3s ease;
        }
        
        .back-btn:hover {
            color: #d98200;
        }
        
        @media (max-width: 768px) {
            .checkout-container {
                grid-template-columns: 1fr;
                gap: 30px;
                padding: 20px;
            }
            
            .checkout-page {
                padding: 20px 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <!-- Left Side Actions -->
            <div class="header-left">
                <a href="login.html" class="action-btn login-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    LOGIN
                </a>
                <button class="action-btn wishlist-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    WISHLIST
                </button>
                <button class="action-btn cart-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    CART (<span id="cart-count">0</span>)
                </button>
            </div>

            <!-- Center Logo -->
            <div class="logo">WALK WAY</div>

            <!-- Right Side Search -->
            <div class="header-right">
                <div class="search-container">
                    <input type="text" placeholder="Search shoes..." class="search-input">
                    <button class="search-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Navigation Bar Below Header -->
        <div class="nav-container">
            <nav class="nav">
                <a href="index.html">HOME</a>
                <a href="man.html">MEN'S</a>
                <a href="women.html">WOMEN'S</a>
                <a href="kid.html">KID'S</a>
                <a href="sale.html">SALE</a>
                <a href="about.html">ABOUT US</a>
            </nav>
        </div>
    </header>

    <!-- Checkout Page Content -->
    <div class="checkout-page">
        <a href="javascript:history.back()" class="back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5"></path>
                <path d="M12 19l-7-7 7-7"></path>
            </svg>
            Back to Shopping
        </a>
        
        <div class="checkout-header">
            <h1>Secure Checkout</h1>
            <p>Complete your order safely and securely</p>
        </div>
        
        <div class="checkout-container">
            <div class="order-summary">
                <h3>Order Summary</h3>
                <div class="order-items" id="checkout-items">
                    <!-- Items will be loaded here -->
                </div>
                <div class="order-total" id="order-totals">
                    <!-- Totals will be calculated here -->
                </div>
            </div>
            
            <div class="checkout-form">
                <h3>Shipping Information</h3>
                <form id="checkoutForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Phone *</label>
                        <input type="tel" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label>Address *</label>
                        <textarea name="address" required placeholder="Enter your complete address"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>City *</label>
                            <input type="text" name="city" required>
                        </div>
                        <div class="form-group">
                            <label>Pincode *</label>
                            <input type="text" name="pincode" required>
                        </div>
                    </div>
                    
                    <h3>Payment Method</h3>
                    <div class="payment-methods">
                        <label class="payment-option">
                            <input type="radio" name="payment" value="cod" checked>
                            <span>💰 Cash on Delivery</span>
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="payment" value="upi">
                            <span>📱 UPI Payment</span>
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="payment" value="card">
                            <span>💳 Credit/Debit Card</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="place-order-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                        Place Order Securely
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <script src="email-service.js"></script>
    <script>
        // Load checkout page data
        document.addEventListener('DOMContentLoaded', function() {
            loadCheckoutData();
            
            // Handle form submission
            document.getElementById('checkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                placeOrderFromPage(new FormData(this));
            });
        });
        
        function loadCheckoutData() {
            const cart = JSON.parse(localStorage.getItem('walkway_cart')) || [];
            
            if (cart.length === 0) {
                window.location.href = 'index.html';
                return;
            }
            
            // Load cart items
            const itemsContainer = document.getElementById('checkout-items');
            itemsContainer.innerHTML = cart.map(item => `
                <div class="order-item">
                    <img src="${item.image}" alt="${item.name}">
                    <div class="item-details">
                        <h4>${item.name}</h4>
                        <p>₹${item.price} × ${item.quantity}</p>
                    </div>
                    <div class="item-total">₹${item.price * item.quantity}</div>
                </div>
            `).join('');
            
            // Calculate totals
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = 99;
            const total = subtotal + shipping;
            
            document.getElementById('order-totals').innerHTML = `
                <div class="subtotal">Subtotal: ₹${subtotal}</div>
                <div class="shipping">Shipping: ₹${shipping}</div>
                <div class="total">Total: ₹${total}</div>
            `;
        }
        
        async function placeOrderFromPage(formData) {
            const cart = JSON.parse(localStorage.getItem('walkway_cart')) || [];
            const orderData = {
                orderId: 'ORD' + Date.now(),
                items: cart,
                customerInfo: {
                    name: formData.get('fullName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    city: formData.get('city'),
                    pincode: formData.get('pincode')
                },
                paymentMethod: formData.get('payment'),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) + 99,
                orderDate: new Date().toLocaleDateString(),
                status: 'Confirmed'
            };

            // Show loading state
            const submitBtn = document.querySelector('.place-order-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = 'Processing Order...';
            submitBtn.disabled = true;

            try {
                // Send email confirmation
                let emailResult = { success: false };
                try {
                    // Wait for email service to be ready
                    if (window.emailService) {
                        console.log('Sending email with data:', orderData);
                        emailResult = await window.emailService.sendOrderConfirmation(orderData);
                        console.log('Email result:', emailResult);
                        
                        if (emailResult.success) {
                            console.log('✅ Email sent successfully!');
                        } else {
                            console.error('❌ Email failed:', emailResult.error);
                        }
                    } else {
                        console.warn('Email service not available');
                        // Try to initialize email service
                        if (window.EmailService) {
                            window.emailService = new EmailService();
                            await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
                            emailResult = await window.emailService.sendOrderConfirmation(orderData);
                        }
                    }
                } catch (emailError) {
                    console.error('Email service error:', emailError);
                }

                // Save order to localStorage
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                orders.push(orderData);
                localStorage.setItem('orders', JSON.stringify(orders));

                // Clear cart
                localStorage.removeItem('walkway_cart');
                
                // Redirect to success page
                localStorage.setItem('lastOrderId', orderData.orderId);
                localStorage.setItem('emailSent', emailResult?.success ? 'true' : 'false');
                window.location.href = 'order-success.html';
                
            } catch (error) {
                console.error('Order processing error:', error);
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                alert('There was an error processing your order. Please try again.');
            }
        }
    </script>
</body>
</html>
