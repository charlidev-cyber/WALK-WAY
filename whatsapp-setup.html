<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Setup - WalkWay</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #25D366, #128C7E);
            min-height: 100vh;
        }
        
        .setup-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .whatsapp-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #25D366;
            margin-bottom: 10px;
        }
        
        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #25D366;
        }
        
        .step-number {
            background: #25D366;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .phone-input {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus {
            border-color: #25D366;
            outline: none;
        }
        
        .btn {
            background: #25D366;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s ease;
        }
        
        .btn:hover {
            background: #128C7E;
        }
        
        .btn-test {
            background: #007bff;
        }
        
        .btn-test:hover {
            background: #0056b3;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ffeaa7;
        }
        
        .current-number {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 18px;
            text-align: center;
        }
        
        .test-area {
            background: #f1f3f4;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="setup-container">
        <div class="header">
            <div class="whatsapp-icon">üì±</div>
            <h1>WhatsApp Notification Setup</h1>
            <p>Configure your WhatsApp number to receive order notifications</p>
        </div>

        <div class="step">
            <span class="step-number">1</span>
            <strong>Enter Your WhatsApp Number</strong>
            <p>Enter your WhatsApp number to receive order notifications:</p>
            
            <div class="phone-input">
                <input type="text" value="+91" readonly style="width: 60px;">
                <input type="tel" id="phoneNumber" placeholder="9876543210" maxlength="10" style="flex: 1;">
            </div>
            
            <button class="btn" onclick="savePhoneNumber()">Save Number</button>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Current Configuration</strong>
            <p>Your current WhatsApp number:</p>
            <div class="current-number" id="currentNumber">Not configured</div>
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <strong>Test WhatsApp Notification</strong>
            <p>Test if WhatsApp notifications are working:</p>
            
            <div class="test-area">
                <button class="btn btn-test" onclick="testOrderNotification()">Test Order Notification</button>
                <button class="btn btn-test" onclick="testRegistrationNotification()">Test Registration Notification</button>
            </div>
        </div>

        <div class="step">
            <span class="step-number">4</span>
            <strong>How It Works</strong>
            <ul>
                <li>When someone places an order, WhatsApp will automatically open</li>
                <li>A pre-written message with order details will be ready</li>
                <li>You just need to click "Send" in WhatsApp</li>
                <li>Works on both mobile and desktop</li>
                <li>No API keys or setup required - completely free!</li>
            </ul>
        </div>

        <div class="warning">
            <strong>üìù Important Notes:</strong>
            <ul>
                <li>Make sure WhatsApp is installed on your device</li>
                <li>The number should be registered with WhatsApp</li>
                <li>Format: Enter 10 digits without +91 (e.g., 9876543210)</li>
                <li>Notifications will open WhatsApp Web or WhatsApp app</li>
            </ul>
        </div>

        <div class="step">
            <span class="step-number">5</span>
            <strong>Quick Actions</strong>
            <button class="btn" onclick="openAdminDashboard()">Open Admin Dashboard</button>
            <button class="btn" onclick="viewNotifications()">View All Notifications</button>
        </div>
    </div>

    <script src="notification-service.js"></script>
    <script>
        // Load current phone number
        function loadCurrentNumber() {
            const savedNumber = localStorage.getItem('admin_whatsapp_number');
            if (savedNumber) {
                document.getElementById('currentNumber').textContent = '+91 ' + savedNumber;
                document.getElementById('phoneNumber').value = savedNumber;
            }
        }

        // Save phone number
        function savePhoneNumber() {
            const phoneInput = document.getElementById('phoneNumber');
            const phoneNumber = phoneInput.value.trim();
            
            // Validate phone number
            if (!/^\d{10}$/.test(phoneNumber)) {
                alert('Please enter a valid 10-digit phone number');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('admin_whatsapp_number', phoneNumber);
            
            // Update notification service
            if (window.notificationService) {
                // Update the phone number in the notification service
                const script = document.createElement('script');
                script.textContent = `
                    if (window.notificationService) {
                        window.notificationService.adminPhone = '91${phoneNumber}';
                    }
                `;
                document.head.appendChild(script);
            }
            
            // Update display
            document.getElementById('currentNumber').textContent = '+91 ' + phoneNumber;
            
            // Show success message
            showSuccess('‚úÖ WhatsApp number saved successfully!');
            
            // Update the notification-service.js file
            updateNotificationServiceFile(phoneNumber);
        }

        // Update notification service file
        function updateNotificationServiceFile(phoneNumber) {
            // This would ideally update the file, but for now we'll just log it
            console.log(`Update notification-service.js with phone number: 91${phoneNumber}`);
            
            // Show instructions
            showSuccess(`
                üìù Manual Update Required:<br>
                1. Open notification-service.js<br>
                2. Find line: const adminPhone = '919876543210'<br>
                3. Replace with: const adminPhone = '91${phoneNumber}'<br>
                4. Save the file
            `);
        }

        // Test order notification
        function testOrderNotification() {
            const testOrderData = {
                orderId: 'TEST_' + Date.now(),
                customerInfo: {
                    name: 'Test Customer',
                    email: 'test@example.com',
                    phone: '+91 9999999999',
                    address: 'Test Address, Test City',
                    city: 'Test City',
                    pincode: '123456'
                },
                items: [
                    { name: 'Test Shoe', quantity: 1, price: 1999 }
                ],
                total: 2098,
                paymentMethod: 'Cash on Delivery',
                orderDate: new Date().toLocaleDateString()
            };

            if (window.notificationService) {
                window.notificationService.sendWhatsAppNotification(testOrderData);
                showSuccess('üöÄ Test order notification sent! Check if WhatsApp opened.');
            } else {
                alert('Notification service not loaded. Please refresh the page.');
            }
        }

        // Test registration notification
        function testRegistrationNotification() {
            const testUserData = {
                firstName: 'Test',
                lastName: 'User',
                email: 'testuser@example.com',
                phone: '+91 8888888888',
                joinDate: new Date().toLocaleDateString()
            };

            if (window.notificationService) {
                window.notificationService.sendRegistrationNotification(testUserData);
                showSuccess('üöÄ Test registration notification sent! Check if WhatsApp opened.');
            } else {
                alert('Notification service not loaded. Please refresh the page.');
            }
        }

        // Open admin dashboard
        function openAdminDashboard() {
            window.open('admin-notifications.html', '_blank');
        }

        // View notifications
        function viewNotifications() {
            window.open('admin-notifications.html', '_blank');
        }

        // Show success message
        function showSuccess(message) {
            const existingSuccess = document.querySelector('.success');
            if (existingSuccess) {
                existingSuccess.remove();
            }
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.innerHTML = message;
            
            document.querySelector('.step:last-child').after(successDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // Load on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentNumber();
            
            // Auto-focus phone input
            document.getElementById('phoneNumber').focus();
            
            // Format phone number as user types
            document.getElementById('phoneNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 10) {
                    value = value.substring(0, 10);
                }
                e.target.value = value;
            });
        });

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    new Notification('üîî WhatsApp Setup', {
                        body: 'Notifications enabled! You\'ll receive alerts for new orders.',
                        icon: '/favicon.ico'
                    });
                }
            });
        }
    </script>
</body>
</html>
